<div class="product-gallery">
  <!-- Bootstrap Carousel -->
  <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
      {% if product.images %} {% for image_obj in product.images %}
      <div class="carousel-item {% if loop.first %}active{% endif %}">
        <img
          src="{{ image_obj.image.large }}"
          class="d-block w-100"
          alt="{{ image_obj.alt_text or product.name or 'Product Image' }}"
          style="height: 500px; object-fit: cover"
        />
      </div>
      {% endfor %} {% else %}
      <!-- Fallback placeholder if no images -->
      <div class="carousel-item active">
        <div class="bg-light d-flex align-items-center justify-content-center" style="height: 500px">
          <span class="text-muted">Main Product Image</span>
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Custom Carousel controls -->
    <button
      class="carousel-control-prev"
      type="button"
      data-bs-target="#productCarousel"
      data-bs-slide="prev"
      style="
        width: 40px;
        height: 40px;
        background-color: rgba(255, 255, 255, 0.8);
        border-radius: 50%;
        top: 50%;
        transform: translateY(-50%);
        left: 10px;
        border: none;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      "
    >
      <i class="bi bi-chevron-left text-dark"></i>
      <span class="visually-hidden">Previous</span>
    </button>
    <button
      class="carousel-control-next"
      type="button"
      data-bs-target="#productCarousel"
      data-bs-slide="next"
      style="
        width: 40px;
        height: 40px;
        background-color: rgba(255, 255, 255, 0.8);
        border-radius: 50%;
        top: 50%;
        transform: translateY(-50%);
        right: 10px;
        border: none;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      "
    >
      <i class="bi bi-chevron-right text-dark"></i>
      <span class="visually-hidden">Next</span>
    </button>
  </div>

  <!-- Thumbnail Images -->
  <div class="thumbnail-gallery mt-3">
    {% if product.images %}
    <div class="row g-2">
      {% for image_obj in product.images %}
      <div class="col">
        <img
          src="{{ image_obj.image.thumbnail }}"
          alt="Thumbnail {{ loop.index }}"
          class="img-thumbnail thumbnail-image {% if loop.first %}active-thumbnail{% endif %}"
          style="height: 80px; width: 100%; object-fit: cover; cursor: pointer; border: 1px solid {% if loop.first %}#666{% else %}#dee2e6{% endif %};"
          data-bs-target="#productCarousel"
          data-bs-slide-to="{{ loop.index0 }}"
          onclick="
                   // Remove active class from current slide
                   document.querySelector('#productCarousel').querySelector('.carousel-item.active').classList.remove('active'); 
                   // Add active class to selected slide
                   document.querySelectorAll('#productCarousel .carousel-item')[{{ loop.index0 }}].classList.add('active');
                   // Remove active border from all thumbnails
                   document.querySelectorAll('.thumbnail-image').forEach(img => {
                     img.style.border = '1px solid #dee2e6';
                     img.classList.remove('active-thumbnail');
                   });
                   // Add active border to clicked thumbnail
                   this.style.border = '1px solid #666';
                   this.classList.add('active-thumbnail');
                 "
        />
      </div>
      {% endfor %}
    </div>
    {% else %}
    <!-- Fallback thumbnails -->
    <div class="row g-2">
      {% for i in range(5) %}
      <div class="col">
        <div class="bg-light d-flex align-items-center justify-content-center img-thumbnail" style="height: 80px">
          <span class="text-muted small">Thumb {{ i + 1 }}</span>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}
  </div>
</div>